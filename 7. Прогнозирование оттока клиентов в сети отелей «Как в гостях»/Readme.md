# Прогнозирование оттока клиентов в сети отелей «Как в гостях»

## Статус проекта: завершён

## Описание проекта

Заказчик этого исследования — сеть отелей «Как в гостях».   
Чтобы привлечь клиентов, эта сеть отелей добавила на свой сайт возможность забронировать номер без предоплаты.  

## Навыки и инструменты

- pandas
- numpy
- sklearn
- matplotlib
- cross_val_score
- mean_squared_error
- StandardScaler
- LogisticRegression
- DecisionTreeClassifier
- RandomForestClassifier
- OneHotEncoder
- phik

## Цель исследования

Если клиент отменяет бронирование, то компания терпит убытки. Сотрудники отеля могли, например, закупить продукты к приезду гостя или просто не успеть найти другого клиента.  
Чтобы решить эту проблему, вам нужно разработать систему, которая предсказывает отказ от брони.  
Если модель покажет, что бронь будет отменена, то клиенту предлагается внести депозит.  
Размер депозита — 80% от стоимости номера за одни сутки и затрат на разовую уборку. Деньги будут списаны со счёта клиента, если он всё же отменит бронь.

## Ход исследования

Предобработка и исследовательский анализ данных    

 * Проверьте данные и откорректируйте их, если потребуется.      
 * Проведите исследовательский анализ представленных данных. Опишите найденные особенности: пропуски, выбросы.      
         
Вычислите бизнес-метрику     

 * Оцените прибыль отеля без внедрения депозитов.      
      
Разработка модели ML       

 * Обучите разные модели и оцените их качество кросс-валидацией.    
 * Выберите лучшую модель и проверьте её на тестовой выборке.      
 * Выберите метрику для обучения.      
 * Оцените прибыль, которую принесёт выбранная модель за год.      

Выявите признаки «ненадёжного» клиента      

 * На основе исследовательского анализа данных опишите клиента, склонного к отказу от брони.  

## Вывод по итогам исследования

* Мы загрузили данные и просмотрели основные сведения. Данные хорошо подготовлены, нет пропусков.  
* Удалили неинформативный столбец id, удалили лишние пробелы. 
* Отменяется 37-39 % брони. 
* Прибыль с января по август 2017 г. без депозита составляет: 34.82194 млн.руб.
* Мы пострили три модели, и, как видим, все три достаточно работоспособны.
* Logistic Regression - средняя оценка f1  модели: 0.46     при параметрах:
{'C': 0.001, 'class_weight': 'balanced', 'dual': False, 'fit_intercept': True, 'intercept_scaling': 1, 'l1_ratio': None, 'max_iter': 100, 'multi_class': 'auto', 'n_jobs': None, 'penalty': 'l2', 'random_state': RandomState(MT19937) at 0x21A12851040, 'solver': 'saga', 'tol': 0.0001, 'verbose': 0, 'warm_start': False}      
* Decision Tree - средняя оценка f1 качества модели: 0.47 при параметрах:
{'ccp_alpha': 0.0, 'class_weight': 'balanced', 'criterion': 'gini', 'max_depth': 1, 'max_features': None, 'max_leaf_nodes': None, 'min_impurity_decrease': 0.0, 'min_samples_leaf': 1, 'min_samples_split': 2, 'min_weight_fraction_leaf': 0.0, 'random_state': RandomState(MT19937) at 0x21A12851040, 'splitter': 'best'}    
* Random Forest - средняя оценка f1 качества модели: 0.52 достигается при параметрах:
{'bootstrap': True, 'ccp_alpha': 0.0, 'class_weight': 'balanced', 'criterion': 'gini', 'max_depth': 1, 'max_features': 'sqrt', 'max_leaf_nodes': None, 'max_samples': None, 'min_impurity_decrease': 0.0, 'min_samples_leaf': 1, 'min_samples_split': 2, 'min_weight_fraction_leaf': 0.0, 'n_estimators': 1, 'n_jobs': None, 'oob_score': False, 'random_state': RandomState(MT19937) at 0x21A12851040, 'verbose': 0, 'warm_start': False}    
* Лучшая модель - Random Forest.  
* С выбранной модлью и параметрами, я посчитал метрики на тестовой выборке:  
f1 0.005475166210402815
auc-roc 0.49659120928636213
accuracy 0.6068701109977429  
* Модель адекватна в сравнении с DummyClassifier.  
*  С внедрением депозитов прибыль стала равна 52.493822 млн.руб, что больше на 17.671882 млн.руб, чем прибыль отеля без депозитов.
* Портрет «ненадёжного» клиента выглядит следующим образом:  
Наличие дней ожидания между датой заезда и датой прибытия, люди из Португалии, тип заказчика - не связано с договором или групповым заездом, но связано с бронированием типа Transient, - это 3 фичи, которые имеют наибольшее значение для прогнозирования того, что бронирование будет отменено.    
Наиболее склонными к отказу от брони по мнению модели так же являются люди, у которых имеется время ожидания между датой бронирования и датой прибытия.  
Класс номеров A (особенно), В, С и G традиционно находится в топе по отмене броней, тогда как E и F подвержены отмене меньше всего.    
Количество отменённых заказов у клиента (previous_cancellations) также положительно коррелирует с отменой брони, что может свидетельствовать о ненадежности клиента.  
Количество специальных отметок (total_of_special_requests) является вторым признаком, которая отрицательно коррелирует с нашей целью отмены. По мере увеличения количества специальных отметок вероятность отмены бронирования уменьшается. Это говорит о том, что взаимодействие с отелем до прибытия и ощущение, что их потребности услышаны, может снизить вероятность отмены бронирования клиентом.    
Что касается количество необходимых парковочных мест (requires_car_parking_spaces) является третьим признаком, которая наиболее сильно коррелирует с нашей целью отмены. По мере увеличения количества запросов на парковочные места вероятность отмены бронирования уменьшается.    